<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="rxjs.js" ></script>
    <title>Document</title>
</head>
<body>
    <!-- <h1>Formulario</h1>
    <label>Nome</label> -->
    <!-- <button id="rxjsButton" >Clique aqui rxjs</button> -->

    <form id="meuFormulario">
<!--       <label for="id">Id:</label>-->
<!--       <input type="text" id="id" name="id"><br><br>-->

        <label for="nome">Nome:</label>
        <input type="text" id="nome" value="Winged Hussars" name="nome"><br><br>

        <label for="duracao">Duração:</label>
        <input type="text" id="duracao" value="3:51" name="nome"><br><br>

        <label for="genero">Genero:</label>
        <input type="text" id="genero" value="1" name="nome"><br><br>

        <label for="faixaNumero">Faixa:</label>
        <input type="text" id="faixaNumero" value="1" name="nacionalidade"><br><br>

        <label for="dtLancamento">Data de lançamento:</label>
        <input type="date" id="dtLancamento" value="2016-10-06" name="nacionalidade"><br><br>

        <label for="arquivoFaixa">Selecione um arquivo:</label>
        <input type="file" accept="audio/*" id="arquivoFaixa" name="arquivoFaixa"><br><br>

        <!-- <input type="submit" id="enviar" value="Enviar"> -->

    </form>

    <button id="enviar" >Clique aqui!</button>

    <script>

        const {fromEvent} = rxjs
        const {map} = rxjs.operators

        const nome = document.getElementById('nome').value;
        const genero = document.getElementById('genero').value;
        const duracao = document.getElementById('duracao').value;
        const faixaNumero = document.getElementById('faixaNumero').value;
        const dtLancamento = document.getElementById('dtLancamento').value;
        const arquivoFaixa = document.getElementById('arquivoFaixa');

        const form = document.getElementById('meuFormulario')
        // const rxjsButton = document.getElementById('rxjsButton');

        // const click = fromEvent(rxjsButton, 'click')

        // const doubleClicks = click.pipe(
        //     map(() => 'cliques')
        // )

        // doubleClicks.subscribe(message => console.log(message)  )
         let base64Image = ""

        arquivoFaixa.addEventListener('change', function(event) {
            const file = event.target.files[0];
            const reader = new FileReader();

            reader.onload = function() {
                base64Image = reader.result;  // Obtenha a string base64 aqui
                // document.getElementById('preview').src = base64Image;  // Exibir imagem como pré-visualização
            };

            reader.readAsDataURL(file);  // Converte para base64
        });


    document.getElementById("enviar").addEventListener("click", function() {
        uploadImage()
    })

    function uploadImage() {
        const data = {
            id: 1,
            nome: nome,
            genero: {
                id: genero
            },
            arquivoFaixa: base64Image, // Inclui a imagem codificada em base64
            duracao: duracao,
            faixaNumero: faixaNumero,
            dtLancamento: dtLancamento
        };

        fetch('http://localhost:8080/musica', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        })
        .then(response => response.json())
        .then(data => console.log('Sucesso:', data))
        .catch((error) => console.error('Erro:', error));
    }

    </script>
</body>
</html>
